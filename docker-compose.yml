version: '3.8'

services:
  # MySQL Datenbank
  mysql:
    image: mysql:8.0
    container_name: bpc-buchung-mysql
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: buchung
      MYSQL_USER: buchung_user
      MYSQL_PASSWORD: buchung_pass
    ports:
      - "3307:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database:/docker-entrypoint-initdb.d
    networks:
      - buchung-network
    restart: unless-stopped
    command: --default-authentication-plugin=mysql_native_password

  # PHP-Apache Webserver
  webserver:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bpc-buchung-web
    ports:
      - "8081:80"
    volumes:
      - ./:/var/www/html
    networks:
      - buchung-network
    depends_on:
      - mysql
    restart: unless-stopped

  # Composer für Abhängigkeiten
  composer:
    image: composer:latest
    container_name: bpc-buchung-composer
    volumes:
      - ./:/app
    working_dir: /app
    command: install --ignore-platform-reqs
    networks:
      - buchung-network

networks:
  buchung-network:
    name: buchung-network
    external: false

volumes:
  mysql_data:

# Hinweise:
# 1. MySQL läuft im Container (Port 3307 auf Host gemappt)
# 2. DB_HOST in config.php muss 'mysql' sein (Docker internal)
# 3. Starte mit: docker compose up -d
# 4. Öffne: http://localhost:8081
# 5. Stoppe mit: docker compose down
